name: Hotfix Auto PR


on:
  create:
    branches:
      - 'hotfix/*'
      - 'release/*'

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pull-requests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the repository
        uses: actions/checkout@v4

      - name: Set PR Targets
        id: targets
        run: |
          # Determine the targets based on branch name
          if [[ "${GITHUB_REF#refs/heads/}" == hotfix/* ]]; then
            echo "targets=main dev release/*" >> $GITHUB_ENV
            echo "label=hotfix" >> $GITHUB_ENV
          elif [[ "${GITHUB_REF#refs/heads/}" == release/* ]]; then
            echo "targets=main dev" >> $GITHUB_ENV
            echo "label=hotfix" >> $GITHUB_ENV
          fi

      - name: Create Pull Requests
        run: |
          for target in ${{ env.targets }}; do
            gh pr create --title "PR: Merge ${{ github.ref_name }} into ${target}" \
                         --body "Automatically generated PR for branch ${{ github.ref_name }} to ${target}." \
                         --base ${target} \
                         --head ${{ github.ref_name }} \
                         --label ${{ env.label }} \
                         --draft
          done
        env:
          GH_TOKEN: ${{ secrets.PAT_TOKEN }}
